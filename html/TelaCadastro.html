<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Seus CSS originais -->
    <link rel="stylesheet" href="../css/TeladeCadastro.css">


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <title>Cadastro em 2 Etapas</title>

    <style>
        /* Aparece apenas a etapa ativa */
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }

        /* botão voltar da etapa 2 */
        #voltar {
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container-tela">
    <img style="width: 300px" class="logo-empresa" src="../assets/Logo PRINCIPAL.png">

    <div class="container">

        <!-- ======================== ETAPA 1 ======================== -->
        <div id="etapa1" class="step active">

            <h2>CADASTRAR</h2>
            <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

            <form id="formEtapa1">

                <div class="form-group">
                    <label>Nome completo<span>*</span></label>
                    <input type="text" id="nome">
                    <small class="erro" id="erroNome"></small>
                </div>

                <div class="form-group row">
                    <div class="form-field">
                        <label>CPF<span>*</span></label>
                        <input type="text" id="cpf">
                        <small class="erro" id="erroCpf"></small>
                    </div>
                    <div class="form-field">
                        <label>Telefone<span>*</span></label>
                        <input type="text" id="telefone">
                        <small class="erro" id="erroTelefone"></small>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="form-field">
                        <label>CEP<span>*</span></label>
                        <input type="text" id="cep">
                        <small class="erro" id="erroCep"></small>
                    </div>
                    <div class="form-field">
                        <label>Endereço<span>*</span></label>
                        <input type="text" id="endereco" readonly>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="form-field">
                        <label>Bairro<span>*</span></label>
                        <input type="text" id="bairro" readonly>
                    </div>
                    <div class="form-field">
                        <label>Complemento</label>
                        <input type="text" id="complemento">
                    </div>
                </div>

                <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

                <div class="button">
                    <button class="btn-principal" id="btnEtapa1">AVANÇAR</button>
                </div>
            </form>

        </div>

        <!-- ======================== ETAPA 2 ======================== -->
        <div id="etapa2" class="step">

            <div class="info-top">
                <svg id="voltar" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"/>
                </svg>
                <h2>CADASTRAR</h2>
            </div>

            <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

            <form id="formEtapa2">

                <div class="form-group">
                    <label>E-mail<span>*</span></label>
                    <input type="text" id="email">
                    <small class="erro" id="erroEmail"></small>
                </div>

                <div class="form-group">
                    <label>Senha<span>*</span></label>
                    <input type="password" id="senha">
                    <small class="erro" id="erroSenha"></small>
                </div>

                <div class="form-group">
                    <label>Repita a senha<span>*</span></label>
                    <input type="password" id="repetirSenha">
                    <small class="erro" id="erroRepetirSenha"></small>
                </div>

                <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

                <div class="button">
                    <button class="btn-principal" id="btnCadastrar">CADASTRAR</button>
                </div>

            </form>

        </div>

    </div>
</div>

<script>
/* ============================================================
   ETAPA 1 – Validação e troca para etapa 2
   ============================================================ */
document.getElementById("btnEtapa1").addEventListener("click", (e) => {
    e.preventDefault();

    const nome = document.getElementById("nome");
    const cpf = document.getElementById("cpf");
    const telefone = document.getElementById("telefone");
    const cep = document.getElementById("cep");
    const endereco = document.getElementById("endereco");
    const bairro = document.getElementById("bairro");
    const complemento = document.getElementById("complemento");

    const erroNome = document.getElementById("erroNome");
    const erroCpf = document.getElementById("erroCpf");
    const erroTelefone = document.getElementById("erroTelefone");
    const erroCep = document.getElementById("erroCep");

    erroNome.textContent = "";
    erroCpf.textContent = "";
    erroTelefone.textContent = "";
    erroCep.textContent = "";

    let valido = true;

    if (nome.value.trim() === "") {
        erroNome.textContent = "Digite um nome.";
        valido = false;
    }

    const cpfNum = cpf.value.replace(/\D/g, "");
    if (cpfNum.length !== 11) {
        erroCpf.textContent = "CPF inválido.";
        valido = false;
    }

    const telNum = telefone.value.replace(/\D/g, "");
    if (telNum.length < 10 || telNum.length > 11) {
        erroTelefone.textContent = "Telefone inválido.";
        valido = false;
    }

    const cepNum = cep.value.replace(/\D/g, "");
    if (cepNum.length !== 8) {
        erroCep.textContent = "CEP inválido.";
        valido = false;
    }

    if (!valido) return;

    localStorage.setItem("nome", nome.value);
    localStorage.setItem("cpf", cpfNum);
    localStorage.setItem("telefone", telefone.value);
    localStorage.setItem("cep", cep.value);
    localStorage.setItem("endereco", endereco.value);
    localStorage.setItem("bairro", bairro.value);
    localStorage.setItem("complemento", complemento.value);

    document.getElementById("etapa1").classList.remove("active");
    document.getElementById("etapa2").classList.add("active");
});


/* ============================================================
   ETAPA 2 – Validação final + FETCH
   ============================================================ */
document.getElementById("btnCadastrar").addEventListener("click", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email");
    const senha = document.getElementById("senha");
    const repetir = document.getElementById("repetirSenha");

    const erroEmail = document.getElementById("erroEmail");
    const erroSenha = document.getElementById("erroSenha");
    const erroRepetirSenha = document.getElementById("erroRepetirSenha");

    erroEmail.textContent = "";
    erroSenha.textContent = "";
    erroRepetirSenha.textContent = "";

    let valido = true;

    if (!email.value.includes("@")) {
        erroEmail.textContent = "Email inválido.";
        valido = false;
    }

    if (senha.value.length < 8) {
        erroSenha.textContent = "Senha deve ter 8+ caracteres.";
        valido = false;
    }

    if (senha.value !== repetir.value) {
        erroRepetirSenha.textContent = "Senhas diferentes.";
        valido = false;
    }

    if (!valido) return;

    // criar os dados depois da validação
    const dados = {
        nome: localStorage.getItem("nome"),
        cpf: localStorage.getItem("cpf"),
        telefone: localStorage.getItem("telefone"),
        endereco: localStorage.getItem("endereco"),
        email: email.value,
        senha: senha.value,

        // campos opcionais esperados pela API:
        especializacao: null,
        nivel_experiencia: null,
        email_corporativo: null,

        tipo: "usuario"
    };

     console.log("Dados que serão enviados:", dados);
     
    try {
        const resposta = await fetch("http://localhost:5030/api/usuarios", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(dados)
        });

        const r = await resposta.text();
        alert("Resposta bruta da API: " + r);

    } catch (erro) {
        alert("Erro ao enviar: " + erro.message);
    }
});

/* ============================================================
   BOTÃO VOLTAR PARA ETAPA 1
   ============================================================ */
document.getElementById("voltar").addEventListener("click", () => {
    document.getElementById("etapa2").classList.remove("active");
    document.getElementById("etapa1").classList.add("active");
});
</script>

<!-- API ViaCEP (se usar) -->
<script src="../js/api_cep.js"></script>
</body>
</html>
