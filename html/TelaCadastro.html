<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/TeladeCadastro.css">

    <!--API - CONSULTA CEP-->
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <title>Primeira eatapa do Cadastro</title>
</head>
<body>
    <div class="container" id="cadastro-screen">
        <h2>CADASTRAR</h2>

        <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

        <form id="cadastroForm">
            <!--Campo: Nome-->
            <div class="form-group">
                <label for="nome" class="input-nome">Nome completo<span>*</span></label>
                <input class="input-nome" type="text" id="nome">
                <small class="erro" id="erroNome"></small>
            </div>

            <!--Campo: CPF e Telefone-->
            <div class="form-group row">
                <div class="form-field">
                    <label for="cpf">CPF<span>*</span></label>
                    <input type="text" name="" id="cpf">
                    <small class="erro" id="erroCpf"></small>
                </div>
                <div class="form-field">
                    <label for="telefone">Telefone<span>*</span></label>
                    <input type="tel" id="telefone">
                    <small class="erro" id="erroTelefone"></small>
                </div>
            </div>

            <!--Campos: CEP e Endereço-->
            <div class="form-group row">
                <div class="form-field">
                    <label for="cep">CEP<span>*</span></label>
                    <input type="text" id="cep">
                    <small class="erro" id="erroCep"></small>
                </div>
                <div class="form-field">
                    <label for="endereco">Endereço<span>*</span></label>
                    <input type="text" id="endereco" readonly>
                </div>
            </div>

            <!--Campos: Bairro e Complemento-->
            <div class="form-group row">
                <div class="form-field">
                    <label for="bairro">Bairro<span>*</span></label>
                    <input type="text" id="bairro" readonly>
                </div>
                <div class="form-field">
                    <label for="complemento">Complemento</label>
                    <input type="text" id="complemento" placeholder="Apto, bloco, casa, etc.">
                </div>
            </div>

            <hr style="width: 100%; border: 0; border-top: 1px solid #6A6E72; margin: 10px 0 20px 0;">

            <div class="button">
                <button type="submit" class="btn-principal">AVANÇAR</button>
            </div>
        </form>
        <div class="info-botton">
          <p class="fir">Já possui conta? <a href="TeladeLogin.html">Faça seu login!</a></p>
        </div>
    </div>

    <!-- código fonte da api -->
    <script src="../js/api_cep.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('cadastroForm');
      const nome = document.getElementById("nome");
      const cpf = document.getElementById("cpf");
      const telefone = document.getElementById("telefone");
      const cep = document.getElementById("cep");
      const endereco = document.getElementById("endereco");
      const bairro = document.getElementById("bairro");
      const complemento = document.getElementById("complemento");

      const erroNome = document.getElementById("erroNome");
      const erroCpf = document.getElementById("erroCpf");
      const erroTelefone = document.getElementById("erroTelefone");
      const erroCep = document.getElementById("erroCep");

      // --- Pré-preenche os campos caso haja valores salvos
      nome.value = localStorage.getItem('nome') || '';
      cpf.value = localStorage.getItem('cpf') || '';
      telefone.value = localStorage.getItem('telefone') || '';
      cep.value = localStorage.getItem('cep') || '';
      endereco.value = localStorage.getItem('endereco') || '';
      bairro.value = localStorage.getItem('bairro') || '';
      complemento.value = localStorage.getItem('complemento') || '';

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        // reseta mensagens de erro
        erroNome.textContent = "";
        erroCpf.textContent = "";
        erroTelefone.textContent = "";
        erroCep.textContent = "";

        let valido = true;

        // Validação do nome (apenas letras)
        const regexNome = /^[A-Za-zÀ-ÿ\s]+$/;
        if (nome.value.trim() === "") {
          erroNome.textContent = "Digite um nome.";
          valido = false;
        } else if (!regexNome.test(nome.value)) {
          erroNome.textContent = "Este campo deve conter apenas letras.";
          valido = false;
        }

        // Remove caracteres que não são números
        const cpfNumeros = cpf.value.replace(/\D/g, '');
        const telefoneNumeros = telefone.value.replace(/\D/g, '');
        const cepNumeros = cep.value.replace(/\D/g, '');

        // Validação do CPF (11 números)
        if (cpfNumeros === "") {
          erroCpf.textContent = "Digite seu CPF.";
          valido = false;
        } else if (cpfNumeros.length !== 11) {
          erroCpf.textContent = "CPF inválido. Deve conter 11 números.";
          valido = false;
        }

        // Validação do telefone (11 dígitos)
        if (telefoneNumeros === "") {
          erroTelefone.textContent = "Digite seu telefone.";
          valido = false;
        } else if (telefoneNumeros.length < 10 || telefoneNumeros.length > 11) {
          erroTelefone.textContent = "Telefone inválido. Deve conter 11 dígitos.";
          valido = false;
        }

        // Validação do CEP (8 dígitos)
        if (cepNumeros === "") {
          erroCep.textContent = "Digite seu CEP.";
          valido = false;
        } else if (cepNumeros.length !== 8) {
          erroCep.textContent = "CEP inválido. Deve conter 8 números.";
          valido = false;
        }

        if (valido) {
          // Aqui você pode enviar o formulário ou redirecionar

          // --- Salva os dados no localStorage
          localStorage.setItem('nome', nome.value);
          localStorage.setItem('cpf', cpf.value);
          localStorage.setItem('telefone', telefone.value);
          localStorage.setItem('cep', cep.value);
          localStorage.setItem('endereco', endereco.value);
          localStorage.setItem('bairro', bairro.value);
          localStorage.setItem('complemento', complemento.value);

          window.location.href = "TelaCadastro2.html"; 
        }
      });
    });
  </script>

    <script src="../js/serve.js"></script>

<!--
    <script>
document.querySelector(".btn-principal").addEventListener("click", async (e) => {
  e.preventDefault();

  const dados = {
    nome: document.getElementById("nome").value,
    cpf: document.getElementById("cpf").value,
    telefone: document.getElementById("telefone").value,
    cep: document.getElementById("cep").value,
    endereco: document.getElementById("endereco").value,
    bairro: document.getElementById("bairro").value,
    complemento: document.getElementById("complemento").value
  };

  try {
    const resposta = await fetch("http://localhost:3000/cadastro", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(dados)
    });

    const resultado = await resposta.json();
    alert(resultado.message || "Erro ao cadastrar.");
  } catch (erro) {
    console.error(erro);
    alert("Falha na conexão com o servidor.");
  }
});
  </script>
-->
</body>
</html>